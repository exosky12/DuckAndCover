<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="DuckAndCover.Pages.GamePage"
             Title="Partie en cours"
             ControlTemplate="{StaticResource BackgroundTemplate}">

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Padding="20">

        <!-- Header avec boutons Quit et Dark Mode -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,20,0,10">

            <!-- Bouton Quitter -->
            <Button x:Name="QuitBtn"
                    Grid.Column="0"
                    Text="âœ• Quitter"
                    BackgroundColor="#F44336"
                    TextColor="White"
                    FontAttributes="Bold"
                    CornerRadius="20"
                    Padding="15,8"
                    FontSize="16"
                    Clicked="OnPlayerChooseQuit"
                    HorizontalOptions="Start"
                    VerticalOptions="Center"/>

            <!-- Titre central -->
            <VerticalStackLayout Grid.Column="1" Spacing="5" HorizontalOptions="Center">
                <Label x:Name="GridInfoLabel" 
                       Text="Grille de jeu" 
                       FontSize="32" 
                       FontAttributes="Bold" 
                       TextColor="{AppThemeBinding Light=#222222, Dark=#DDDDDD}" 
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- Bouton Dark Mode -->
            <Button x:Name="DarkModeButton"
                    Grid.Column="2"
                    Text="ðŸŒ™" 
                    FontAttributes="Bold"
                    CornerRadius="25"
                    Padding="12,8"
                    FontSize="20"
                    Clicked="OnDarkModeClicked"
                    HorizontalOptions="End"
                    VerticalOptions="Center"
                    BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#333333}" 
                    BorderColor="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                    BorderWidth="2"
                    TextColor="{AppThemeBinding Light=#2196F3, Dark=#64B5F6}"
                    WidthRequest="55" 
                    HeightRequest="55">
                <Button.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=Black, Dark=Gray}" 
                            Opacity="0.3" 
                            Offset="2,2" 
                            Radius="4"/>
                </Button.Shadow>
            </Button>

        </Grid>

        <!-- Zone d'instructions -->
        <Border Grid.Row="1"
                Background="{SolidColorBrush #E8F5E8}"
                Stroke="#4CAF50"
                StrokeThickness="1"
                Padding="15"
                Margin="10,0,10,15">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="15" />
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="{AppThemeBinding Light=Black, Dark=Gray}" 
                        Opacity="0.3" 
                        Offset="3,3" 
                        Radius="5"/>
            </Border.Shadow>
            <Label x:Name="InstructionsLabel"
                   Text=""
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#2E7D32, Dark=#A5D6A7}"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center"/>
        </Border>

        <!-- Zone de jeu principale -->
        <ScrollView Grid.Row="2">
            <Border Background="{AppThemeBinding Light={SolidColorBrush #F5F5F5}, Dark={SolidColorBrush #333333}}"
                    Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#555555}"
                    StrokeThickness="1"
                    Padding="20"
                    Margin="10">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{AppThemeBinding Light=Black, Dark=Gray}" 
                            Opacity="0.3" 
                            Offset="3,3" 
                            Radius="5"/>
                </Border.Shadow>
                <Grid x:Name="GameGrid"
                      HorizontalOptions="Center"
                      VerticalOptions="Center"
                      Padding="10"/>
            </Border>
        </ScrollView>

        <!-- Carte courante -->
        <Border Grid.Row="3" 
                x:Name="CurrentCardFrame"
                IsVisible="False"
                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#333333}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#555555}"
                StrokeThickness="1"
                Padding="20"
                HorizontalOptions="Center">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="15"/>
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="Black" 
                        Opacity="0.3" 
                        Offset="3,3" 
                        Radius="5"/>
            </Border.Shadow>
            <VerticalStackLayout Spacing="15">
                <Label Text="Carte courante"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#222222, Dark=#DDDDDD}"
                       HorizontalOptions="Center"/>
                <Border x:Name="CurrentCardBorder"
                        WidthRequest="120"
                        HeightRequest="160"
                        Padding="0"
                        Stroke="Transparent"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="15"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black" 
                                Opacity="0.3" 
                                Offset="3,3" 
                                Radius="5"/>
                    </Border.Shadow>
                    <Label x:Name="CurrentCardNumber"
                           FontSize="48"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
            </VerticalStackLayout>
        </Border>

        <!-- Zone des boutons d'action -->
        <Border Grid.Row="4"
                Background="{AppThemeBinding Light=White, Dark=#212121}"
                Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#424242}"
                StrokeThickness="1"
                Padding="25"
                Margin="10,20,10,0">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="25"/>
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="{AppThemeBinding Light=Black, Dark=Gray}" 
                        Opacity="0.3" 
                        Offset="3,3" 
                        Radius="5"/>
            </Border.Shadow>

            <VerticalStackLayout Spacing="25">

                <!-- Boutons d'action principaux -->
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15" HorizontalOptions="Center">

                    <!-- Bouton COVER -->
                    <Border Grid.Column="0"
                            Background="{SolidColorBrush #4CAF50}"
                            Padding="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" 
                                    Opacity="0.3" 
                                    Offset="2,2" 
                                    Radius="4"/>
                        </Border.Shadow>
                        <Button x:Name="CoverBtn"
                                Text="COVER"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="18"
                                CornerRadius="20"
                                Padding="20,25"
                                Clicked="OnCoverClicked"
                                WidthRequest="120"
                                HeightRequest="80"/>
                    </Border>

                    <!-- Bouton DUCK -->
                    <Border Grid.Column="1"
                            Background="{SolidColorBrush #2196F3}"
                            Padding="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" 
                                    Opacity="0.3" 
                                    Offset="2,2" 
                                    Radius="4"/>
                        </Border.Shadow>
                        <Button x:Name="DuckBtn"
                                Text="DUCK"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="18"
                                CornerRadius="20"
                                Padding="20,25"
                                Clicked="OnDuckClicked"
                                WidthRequest="120"
                                HeightRequest="80"/>
                    </Border>

                    <!-- Bouton COIN -->
                    <Border Grid.Column="2"
                            Background="{SolidColorBrush #FF9800}"
                            Padding="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="20"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" 
                                    Opacity="0.3" 
                                    Offset="2,2" 
                                    Radius="4"/>
                        </Border.Shadow>
                        <Button x:Name="CoinBtn"
                                Text="COIN"
                                BackgroundColor="Transparent"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="18"
                                CornerRadius="20"
                                Padding="20,25"
                                Clicked="OnCoinClicked"
                                WidthRequest="120"
                                HeightRequest="80"/>
                    </Border>

                </Grid>

                <!-- Label de debug -->
                <Label x:Name="DebugLabel" 
                       Text="" 
                       FontSize="13" 
                       TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                       Opacity="0.7"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"
                       Margin="0,10,0,0"/>

            </VerticalStackLayout>
        </Border>

    </Grid>
</ContentPage>